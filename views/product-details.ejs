    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <title><%= product.name %> - Product Details</title>
        <link rel="stylesheet" href="/css/product-detail.css">
    </head>
    <body>
        <header class="header-design">
            <div class="container-fluid py-3">
              <div class="container d-flex justify-content-between align-items-center" style="margin-left: 415px;">
                <h1 class="h4 mb-0">
                  <a href="/" class="text-decoration-none" style="margin-left: -130px;"><strong>E-Shop</strong></a>
                </h1>
                <!-- Thanh tìm kiếm -->
                <nav class="nav">
                  <ul class="nav">
                    <li class="nav-item">
                      <a class="nav-link home" href="/">
                        <img src="/img/home.png" alt="" class="home-icon"></img>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link bxh" href="/scoreboard">
                        <img src="/img/bxh.jpg" alt="" class="bxh-icon">
                      </a>
                    </li>
                    <% if (!user) { %>
                    <li class="nav-item">
                      <a class="nav-link login" href="/login">Đăng nhập</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link dangky" href="/register">Đăng ký</a>
                    </li>
                    <% } else { %>
                    <li class="nav-item">
                      <a class="nav-link giohang" href="/cart">
                        <img src="/img/cart.jpg" alt="" class="cart-icon">                  
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link taosanpham" href="/product/add">
                        <img src="/img/add.jpg" alt="" class="add-icon">
                      </a>
                    </li>
                    <li class="nav-item dropdown" style="width: 200px;">
                      <a class="nav-link dropdown-toggle d-flex align-items-center" id="userDropdown" role="button">
                        <% if (user.avatar) { %>
                        <img src="/<%= user.avatar %>" class="avatar me-2" alt="" />
                        <% } else { %>
                        <img src="./img/def.jpg" class="avatar me-2" alt="" />
                        <% } %>
                      </a>
                      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li>
                          <a class="dropdown-item" href="/user/<%= user.id %>">Profile</a>
                        </li>
                        <li><a class="dropdown-item" href="/settings">Cài đặt</a></li>
                        <li><a class="dropdown-item">Balanced: <%= user.balance %> VNĐ</a></li>
                        <li><hr class="dropdown-divider" /></li>
                        <!-- Chuyển đổi giao diện -->
                        <li class="nav-item">
                          <div class="d-flex align-items-center px-3 py-2">
                            <label class="change-mode" for="toggle-dark-mode" id="mode-label">Chế Độ Sáng</label>
                            <label class="switch" >
                              <input type="checkbox" id="toggle-dark-mode">
                              <span class="slider round"></span>
                            </label>
                          </div>
                        </li>
                        <li><hr class="dropdown-divider" /></li>
                        <li><a class="dropdown-item" href="/logout">Đăng xuất</a></li>
                      </ul>
                    </li>                       
                    <% } %>
                  </ul>
                </nav>
              </div>
            </div>
          </header>
        <m1 style="font-size: 50px;"><strong><center>Product Details</center></strong></m1>
        <div class="container-anh" >
            <div class="image-container" style="margin-left: -175px;">
                <a href="/product/<%= product.id %>">
                    <img 
                        src="<%= product.image ? ('/uploads/' + product.image) : '/img/cart-def.png' %>" 
                        class="card-img-top" 
                        alt="" 
                        onerror="this.onerror=null; this.src='/img/cart-def.png';"
                    />
                </a>
            </div>
            <div class="card-body info">
                <div class="details-container">
                    <h2 class ="product_name"><%= product.name %></h2>
                    <% if (product.sale) { %>
                        <p class="card-text product_name" style="margin-bottom:4px ;">
                            <%= formatCurrency((product.price - (product.price * product.saleval / 100))) %> VNĐ
                            <del> <%= product.price %> </del>
                            
                            <span class="badge bg-danger ms-2" style="margin-bottom: 10px;" >-<%= product.saleval %>%</span>
                          </p>
                    <% } else { %>
                        <p class="product_name"><strong>Price:</strong> <%= formatCurrency(product.price) %> VNĐ</p>
                    <% } %>            
                    <p class="thong-tin"><strong>Quantity:</strong> <%= product.quantity %></p>
                    <div class="tuan_anh">
                        <a href="" class="buy-now">Buy Now</a>
                        <a href="" class="add-to-cart">Add to Cart</a>
                        <div style="margin-left: 20px;"><a href="/scoreboard">Bestsellers</a></div>
                    </div>
                </div>
            </div>
        </div>
        <main style="width: 100%; gap: 50px;">
                <div class="row mt-5">
                    <div class="col" style="margin-left: -200px;">
                        <h2 class="section-title text-center product_name" style="margin-left: -120px;">Thông tin sản phẩm:</h2>
                        <div class="square-box description" style="font-size: 20px;">
                            <p class="thong-tin" ><%- product.description %></p>
                        </div>
                        <div class="rating-section">
                            <center><h3 class="alpha" style="margin-bottom: 20px;margin-top: 20px;">Đánh giá sản phẩm</h3></center>
                            <form id="ratingForm" method="POST" action="/product/submit-review">
                              <input type="hidden" name="productId" value="<%= product.id %>">
                          
                              <div style="margin-left: 20px;">
                                <label for="rating" class="alpha" style="font-size: 25px;">Chất lượng sản phẩm</label>
                                <div class="stars" style="gap: 20px;margin-left: 280px;margin-top: -51px;">
                                  <input type="radio" id="star1" name="rating" value="1" required>
                                  <label for="star1" class="star" style="margin-left: -45px;margin-top: -2px;">&#9733;</label>
                              
                                  <input type="radio" id="star2" name="rating" value="2" required>
                                  <label for="star2" class="star" style="margin-left: -45px;margin-top: -2px;">&#9733;</label>
                              
                                  <input type="radio" id="star3" name="rating" value="3" required>
                                  <label for="star3" class="star" style="margin-left: -45px;margin-top: -2px;">&#9733;</label>
                              
                                  <input type="radio" id="star4" name="rating" value="4" required>
                                  <label for="star4" class="star" style="margin-left: -45px;margin-top: -2px;">&#9733;</label>
                              
                                  <input type="radio" id="star5" name="rating" value="5" required> <!-- Đặt mặc định là 5 sao -->
                                  <label for="star5" class="star" style="margin-left: -45px;margin-top: -2px;">&#9733;</label>
                              
                                  <div id="comment" class="comment alpha" style="margin-top: 20px;"></div> <!-- Thêm phần hiển thị bình luận -->
                              </div>
                              
                                
                            </div>
                          
                              <div style="margin-left: 20px;">
                                  <label for="comment" style="font-size: 25px;">Bình luận:</label>
                                  <textarea name="comment" class="comment-write" style="margin-left: -12px;" rows="4"></textarea>
                              </div>
                              <center><button type="submit">Gửi đánh giá</button></center>
                          </form>                       
                        </div>
                        
                        <div class="reviews">Z
                            <center><h3>Đánh giá</h3></center>
                            <% if (ratings.length > 0) { %>
                                <% ratings.forEach(review => { %>
                                  <div class="review">
                                    <div class="review-header">
                                        <img class="avatar" src="/img/def.jpg" alt="Avatar"> <!-- Ảnh đại diện -->
                                        <div class="user-info" style="margin-left: 6%; margin-top: -45px; width: auto;">
                                          <div class="my-3 user-name" style="font-size: 20px;">
                                              NAME
                                          </div>
                                          <p class="review-date alpha" style="margin-left: 10%; margin-top: -7%; font-size: 20px;">
                                            Ngày: <%= new Date(review.created_at).toLocaleString() %> <!-- Ngày giờ tạo -->
                                        </p> 
                                      </div>
                                                                           
                                        <div class="review-rating">
                                            <% for (let i = 1; i <= 5; i++) { %>
                                                <% if (i <= review.rating) { %>
                                                    <span class="star" style="color: yellow;">★</span> <!-- Sao đã đánh giá -->
                                                <% } else { %>
                                                    <span class="star">☆</span> <!-- Sao chưa đánh giá -->
                                                <% } %>
                                            <% } %>
                                        </div>
                                    </div>
                                    <p class="review-comment alpha" style="font-size: 25px;"><%= review.comment || 'Chưa có bình luận' %></p> <!-- Bình luận -->
                                </div>
                                
                                <% }) %>
                            <% } else { %>
                                <p class="alpha">Chưa có đánh giá nào cho sản phẩm này.</p>
                            <% } %>
                        </div>
                        
                                             
                    </div>                    
                    
                    <div class="col">
                        <h2 class="section-title text-center product_name" style="margin-left:-100px">Sản phẩm gợi ý</h2>
                        <div class="row row-cols-1 row-cols-md-5 g-4 " style="margin-left:-000px; gap: 50px;height: auto;width: auto;">
                            <% products.forEach(product=> { %>
                                <div class="col">
                                    <div class="card product-card " >
                                        <a href="/product/<%= product.id %>">
                                            <img 
                                                src="<%= product.image ? ('/uploads/' + product.image) : '/img/cart-def.png' %>" 
                                                class="card-img-top" 
                                                alt="" 
                                                onerror="this.onerror=null; this.src='/img/cart-def.png';"
                                            />
                                        </a>
                                      <div class="card-body ">
                                        <h4 class="card-title"><center><%= product.name %></center></h4>
                                        <% if (product.sale) { %>
                                          <center><span class="badge bg-danger ms-2" style="margin-bottom: 5px;" >-<%= product.saleval %>%</span></center>
                                          <p class="card-text product_name" style="margin-bottom:4px ;">
                                            Giá:<del> <%= product.price %> </del>
                                            <%= formatCurrency((product.price - (product.price * product.saleval /
                                            100)).toFixed(0))%> VNĐ
                                          </p>
                                          <div style="padding-left: 1px; padding-bottom: 10px">
                                            <div class ="creator-day " style ="margin-top: -0px;">
                                                <p class="card-text product_name" style="margin-bottom: 3px">
                                                  Creator: <%= product.creator %>
                                                </p>
                                                <p class="card-text product_name" style="margin-top: 0px">
                                                    Ngày tạo: <%= product.formatted_date %>
                                                </p>
                                            </div>
                                            <div class="d-flex mt-3" style="gap: 10px; margin-top: -100px;">
                                                <a href="/product/<%= product.id %>" class="btn btn-success rounded center-text">
                                                    <div>Thông tin</div>
                                                    <div>sản phẩm</div>
                                                </a>
                                                <a>
                                                    <button type="button" class="btn btn-primary rounded addToCartBtn" data-product-id="<%= product.id %>">
                                                        Thêm vào giỏ
                                                    </button>
                                                </a>
                                            </div>                                            
                                        <% } else { %>
                                          <div style="margin-top: 40px;">
                                              <p class="card-text product_name">Giá: <%= formatCurrency(product.price) %> VNĐ</p>
                                          </div>
                                          <div style="padding-left: -10px; padding-bottom: 10px">
                                            <div class ="creator-day" style ="margin-top:1px;">
                                                <p class="card-text product_name" style="margin-bottom: -2px">
                                                  Creator: <%= product.creator %>
                                                </p>
                                                <p class="card-text product_name" style="margin-top: 3px">
                                                  Ngày tạo: <%= product.formatted_date %>
                                                </p>
                                            </div>
                                            <div class="d-flex mt-3" style="gap: 10px; margin-top: 30px;">
                                                <a href="/product/<%= product.id %>" class="btn btn-success rounded center-text">
                                                    <div>Thông tin</div>
                                                    <div>sản phẩm</div>
                                                </a>
                                                <a>
                                                    <button type="button" class="btn btn-primary rounded addToCartBtn" data-product-id="<%= product.id %>">
                                                        Thêm vào giỏ
                                                    </button>
                                                </a>
                                            </div>
                                        <% } %>
                                      </div>
                                      </div>
                                    </div>
                                  </div>
                                <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        
        
    </body>
    <script src="/darkmode.js"></script>
    <script src="/star.js"></script>
</html>